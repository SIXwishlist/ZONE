<div id="modalNewSource" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel"><%= t("source.new.title")%></h3>
  </div>
  <div class="modal-body">
    <%= render 'form' %>
  </div>
</div>

<div id="modalNewImport" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel"><%= t("source.opml.title")%></h3>
  </div>
  <div class="modal-body">
    <%= form_for(:upload, :url => { :action => "uploadopml" }, :html => { :multipart => true }, :remote => true) do |form| %>
		<div class="row-fluid">
			<div class="span10 offset1">
				<span id="fileTextName" data-initial="<%= t("source.opml.empty")%>"><%= t("source.opml.empty")%></span>
			</div>
		</div>
		<div class="row-fluid">
			<div class="span5 offset1">
				<input id="upload_datafile" name="upload[datafile]" type="file" hidden onchange="updateFilename($(this).val())">
				<button id="btnImport" class="btn btn-info span12" onclick="$('#upload_datafile').click();return false;">
					<%= t("source.opml.button.select")%>
				</button>
			</div>
			<div class="span5">
				<%= form.submit t("source.opml.button.upload"),:class => 'btn btn-success span12', :onclick => '$("#fileTextName").html("")'%>
			</div>
		</div>
	<% end %>
  </div>
</div>
<div class="row-fluid">
	<div class="span12">
		<h1><%= t("source.title")%></h1>
	</div>
</div>
<div class="row-fluid">
	<div class="span10 offset1">
		<a href="#modalNewSource" role="button" class="btn btn-success" data-toggle="modal"><%= t("source.new.title")%></a>
		<a href="#modalNewImport" role="button" class="btn btn-danger" data-toggle="modal"><%= t("source.opml.title")%></a>
	</div>
</div>

<hr class="span10 offset1"/>

<% actualTableTheme = nil%>

<% @sources.sort! {|a,b| [a.theme,a.label,a.uri,a.lang]<=>[b.theme,b.label,b.uri,b.lang]}  %>
<div class="row-fluid" >
	<div id="navTheme" class="span2 offset1">
		<ul class="nav nav-list span2 affix" data-spy="affix" data-offset-top="0">
			<% firstClass = "active" %>
			<% @sources.each do |source| %>
				<% next if source == nil  %>
				<% if source.theme == "" %>
					<% source.theme = "undefined" %>
				<% end %>
				<% next if source.theme == actualTableTheme  %>
			  	<li class="<%= firstClass %>">
			  		<a href="#source<%= source.theme %>">
			  			<%= source.theme %> <i class="icon-chevron-right pull-right"></i>
			  		</a>
			  		
			  	</li>
			  	<% actualTableTheme = source.theme %>
			  	<% firstClass = "" %>
			<% end %>
			<li><a id="btn_up" href="#toppage"><i class="icon-collapse-top"></i> <%= t("source.menu.gotop")%></a></li>
		</ul>
	</div>
	<div id="scrollTable" class="span9">
		<% startNewTable = true %>
		<% actualTableTheme = nil%>
		<% numberTheme = 0 %>
		
		<% @sources.each do |source| %>
			<% next if source == nil  %>
			<% filter = Filter.new(:prop => "http://purl.org/rss/1.0/source",:value => source.uri) %>
			<% uriNumber = filters_getNumber_path(:old => [filter]) %>
			
			<% if source.theme == "" %>
				<% source.theme = "undefined" %>
			<% end %>
			
			<% if source.theme != actualTableTheme%>
				<% startNewTable = true %>
				<% numberTheme += 1 %>
				<% if actualTableTheme != nil%>
					</tbody>
					</table>
					</fieldset>
				<% end %>
			<% end %>
			<% if startNewTable %>
				<fieldset id="source<%= source.theme %>">
					<table class="table table-bordered table-striped">
						<thead>
							<tr>
								<th class="span1 text-center"><%= t("source.list.action")%></th>
								<th class="span3"><%= t("source.list.label")%></th>
								<th class="span5"><%= t("source.list.uri")%></th>
								<th class="span1 text-center"><%= t("source.list.lang")%></th>
							</tr>
						</thead>
						<tbody>
			<% end %>
			<tr>
				<td class="text-center"><%= link_to "",edit_source_path(source) , :class => 'icon-edit', :title => t("edit")  %> <a href="/sources/<%= source.to_param%>/delete" title="<%= t("delete")%>"><i class="icon-trash"></i></a></td>
				<td><%= source.label %></td>
				<td><%= link_to source.uri, url_for(:controller => :searches, :action => :create,  :sources => {:rss => [source.uri]}), :method => "post" %></td>
				<td class="text-center"><%= source.lang.upcase %></td>
			</tr>
			<% actualTableTheme = source.theme%>
			<% startNewTable = false%>
		<% end %>
		<% if @sources.count > 0%>
			</tbody>
			</table>
			</fieldset>
		<% end %>
	</div>
</div>
